import argparse

from emmail import __name__ as name, __description__ as description, __version__ as version, __author__ as author, __email__ as email
from emmail.objects.blast import BLAST
from emmail.utilities import runBLAST

from emmail.objects.ispcr import IsPCR
from emmail.utilities import runIsPCR

def buildParser():
    parser = argparse.ArgumentParser(prog=name, 
                                    description="{} - Version {}".format(description, version),
                                    epilog="Developed by {} ({})".format(author, email))
    subparsers = parser.add_subparsers(title='Pipelines to choose from',
                                       metavar='')

    # BLAST subparser
    parser_blast = subparsers.add_parser("blast", help="Direct BLAST to genome reads.")
    parser_blast = runBLAST.buildSubparser(parser_blast)
    parser_blast.set_defaults(func=runBLAST.main)

    # PCR + BLAST subparser
    
    parser_pcr = subparsers.add_parser("pcr", help="PCR genome, then BLAST against it.")
    parser_pcr = runIsPCR.buildSubparser(parser_pcr)
    parser_pcr.set_defaults(func=runIsPCR.main)

    return parser

def main():
    parser = buildParser()
    args = parser.parse_args()
    args.func(args)

if __name__ == "__main__":
    main()
